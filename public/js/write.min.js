new Vue({el:"#writePage",data:{title:"",coverUrl:"",editor:"",create_flag:!1,new_classify:"",classify:[],classifyValue:""},created:function(){this.getClassify()},mounted:function(){this.createEditor(),this.transformImg()},methods:{show_create:function(){this.create_flag=!0},getClassify:function(){var i=this;$.ajax({url:"/api/getClassify",type:"get",dataType:"json",success:function(e){if(200==e.code)for(var t=0;t<e.body.length;t++)i.classify.push({value:e.body[t].id,label:e.body[t].value})}})},createEditor:function(){var e=window.wangEditor;this.editor=new e("#editor"),this.editor.customConfig.uploadImgShowBase64=!0,this.editor.create()},transformImg:function(){var s=this,e=document.getElementById("fileSelect"),t=document.getElementById("upload_file");e.addEventListener("click",function(e){t&&t.click(),e.preventDefault()},!1),$("#upload_file").on("change",function(e){var t=e.target.files[0],i=new FileReader;i.readAsDataURL(t),i.onloadend=function(){var e=i.result;s.coverUrl=e}})},publish:function(){var e=this.editor.txt.html(),t=this.editor.txt.text(),i=t.substring(0,70)+"...",s={word_id:"",title:this.title,cover:this.coverUrl,classify_id:this.classifyValue,newclassify:this.new_classify,content:e,abs:i,word_num:t.length},a=this;$.ajax({url:"/api/article",type:"post",dataType:"json",data:s,success:function(e){200!=e.code?a.$message.warning(e.body):a.$message.success("发布成功")},error:function(){a.$message.error("当前网络不佳，请稍后重试")}})},comfirm:function(){var e=this;if(!this.title.length)return this.$message({message:"请输入文章标题",type:"warning"}),!1;if("<p><br></p>"==this.editor.txt.html())return this.$message({message:"请输入文章内容",type:"warning"}),!1;if(this.new_classify)this.$confirm("新增分类的文章不会立即发布，通过审核后才会发布","提示",{confirmButtonText:"继续发布",cancelButtonText:"暂不发布",type:"info"}).then(function(){e.publish()});else{if(!this.classifyValue)return this.$message({message:"请选择文章分类",type:"warning"}),!1;this.publish()}}}});