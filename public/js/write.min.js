new Vue({el:"#writePage",data:{title:"",coverUrl:"",editor:"",create_flag:!1,new_classify:"",c_first:[],c_first_value:"",c_second:[],c_second_value:""},created:function(){this.getC_first()},mounted:function(){this.createEditor(),this.transformImg()},methods:{show_create:function(){this.create_flag=!0},getC_first:function(){var i=this;$.ajax({url:"/api/getC_first",type:"get",dataType:"json",success:function(e){if(200==e.code)for(var t=0;t<e.body.length;t++)i.c_first.push({value:e.body[t].id,label:e.body[t].value})}})},c_first_callback:function(e){var i=this;$.ajax({url:"/api/getC_second",type:"get",data:{parent_id:e},dataType:"json",success:function(e){if(200==e.code)for(var t=0;t<e.body.length;t++)i.c_second.push({value:e.body[t].id,label:e.body[t].value});else i.c_second=[]}})},createEditor:function(){var e=window.wangEditor,s=this;this.editor=new e("#editor"),this.editor.customConfig.uploadImgServer="/api/upload/acticle",this.editor.customConfig.uploadTimeout=1e8,this.editor.create(),this.editor.customConfig.uploadImgHooks={before:function(e,t,i){},success:function(e,t,i){},fail:function(e,t,i){s.$message.error("图片加载失败")},error:function(e,t){s.$message.error("图片上传失败")},timeout:function(e,t){s.$message.error("图片上传超时")}}},transformImg:function(){var s=this,e=document.getElementById("fileSelect"),t=document.getElementById("upload_file");e.addEventListener("click",function(e){t&&t.click(),e.preventDefault()},!1),$("#upload_file").on("change",function(e){var t=e.target.files[0],i=new FileReader;i.readAsDataURL(t),i.onloadend=function(){var e=i.result;s.coverUrl=e}})},publish:function(e,t){var i=t.substring(0,100)+"...",s={word_id:"",title:this.title,cover:this.coverUrl,c_first_id:this.c_first_value,c_second_id:this.c_second_value,newclassify:this.new_classify,content:e,text:t,abs:i,word_num:t.length},n=this;$.ajax({url:"/api/article",type:"post",dataType:"json",data:s,success:function(e){200!=e.code?n.$message.warning(e.body):window.location.href=e.body},error:function(){n.$message.error("当前网络不佳，请稍后重试")}})},comfirm:function(){var e=this;if(!this.title.length)return this.$message({message:"请输入文章标题",type:"warning"}),!1;var t=this.editor.txt.html(),i=this.editor.txt.text();if("<p><br></p>"==t)return this.$message({message:"请输入文章内容",type:"warning"}),!1;if(""==this.c_first_value)return this.$message({message:"请选择一级分类",type:"warning"}),!1;if(this.new_classify)this.$confirm("新增分类的文章不会立即发布，通过审核后才会发布","提示",{confirmButtonText:"继续发布",cancelButtonText:"暂不发布",type:"info"}).then(function(){e.publish(t,i)});else{if(!this.c_second_value)return this.$message({message:"请选择二级分类",type:"warning"}),!1;this.publish(t,i)}}}});