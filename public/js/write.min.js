new Vue({el:"#writePage",data:{title:"",coverUrl:"",editor:"",create_flag:!1,new_classify:"",classify:[],classifyValue:""},created:function(){this.getClassify()},mounted:function(){this.createEditor(),this.transformImg()},methods:{show_create:function(){this.create_flag=!0},getClassify:function(){var i=this;$.ajax({url:"/api/getClassify",type:"get",dataType:"json",success:function(t){if(200==t.code)for(var e=0;e<t.body.length;e++)i.classify.push({value:t.body[e].id,label:t.body[e].value})}})},createEditor:function(){var t=window.wangEditor;this.editor=new t("#editor"),this.editor.customConfig.uploadImgShowBase64=!0,this.editor.create()},transformImg:function(){var s=this,t=document.getElementById("fileSelect"),e=document.getElementById("upload_file");t.addEventListener("click",function(t){e&&e.click(),t.preventDefault()},!1),$("#upload_file").on("change",function(t){var e=t.target.files[0],i=new FileReader;i.readAsDataURL(e),i.onloadend=function(){var t=i.result;s.coverUrl=t}})},publish:function(){var t=this.editor.txt.html(),e=this.editor.txt.text(),i=e.substring(0,70)+"...",s={word_id:"",title:this.title,cover:this.coverUrl,classify_id:this.classifyValue,newclassify:this.new_classify,content:t,abs:i,word_num:e.length},a=this;$.ajax({url:"/api/article",type:"post",dataType:"json",data:s,success:function(t){200!=t.code&&a.$message.warning(t.body)},error:function(){a.$message.error("当前网络不佳，请稍后重试")}})},comfirm:function(){var t=this;if(!this.title.length)return this.$message({message:"请输入文章标题",type:"warning"}),!1;if("<p><br></p>"==this.editor.txt.html())return this.$message({message:"请输入文章内容",type:"warning"}),!1;if(this.new_classify)this.$confirm("新增分类的文章不会立即发布，通过审核后才会发布","提示",{confirmButtonText:"继续发布",cancelButtonText:"暂不发布",type:"info"}).then(function(){t.publish()});else{if(!this.classifyValue)return this.$message({message:"请选择文章分类",type:"warning"}),!1;this.publish()}}}});