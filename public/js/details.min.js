new Vue({delimiters:["${","}"],el:"#detailsPage",data:{article_id:"",classify_id:"",author_id:"",reviewFlag:!1,review_content:"",comment_list:[],comment_page:1,comment_count:0,comment_show:2,recommendList:[]},created:function(){},mounted:function(){this.init(),this.delayload()},directives:{focus:{update:function(e,t){t.value&&e.focus()}}},filters:{date:dateYmdHis},methods:{init:function(){var e=this;this.article_id=$("#article_id").val(),this.classify_id=$("#classify_id").val(),this.author_id=$("#author_id").val(),$("body").on("click",function(){$(".receipt_code").hide(500)}),$(".like-group").on("click",function(){getCookie("userInfo")?$(this).hasClass("unlike")?($(this).removeClass("unlike").addClass("islike"),e.likefun(1)):($(this).removeClass("islike").addClass("unlike"),e.likefun(0)):goLogin(e,"喜欢这篇文章需要登录，现在去登录？")})},delayload:function(){var e=this,t=1;$(window).scroll(function(){$("#comments")[0].offsetTop-$(window).scrollTop()<600&&1==t&&(t=0,e.getComment_list(),e.getrecommend())})},rewardswitch:function(){$(".receipt_code").show(500)},likefun:function(e){var t=this;$.ajax({url:"/api/islike",type:"get",dataType:"json",data:{islike:e,article_id:this.article_id,author_id:this.author_id},success:function(e){200!=e.code&&t.$message.warning(e.body)},error:function(){t.$message.error("当前网络不佳，请稍后重试")}})},review_send:function(){var t=this;if(!this.review_content.length)return this.$message.warning("回复内容不能为空"),!1;$.ajax({url:"/api/publish/comment",type:"post",dataType:"json",data:{article_id:this.article_id,content:this.review_content},success:function(e){200!=e.code?t.$message.warning(e.body):(t.review_content="",t.reviewFlag=!1,t.$message.success("评论成功"),t.comment_page=1,t.getComment_list())},error:function(){t.$message.error("当前网络不佳，请稍后重试")}})},pageChange:function(e){this.comment_page=e,this.getComment_list()},getComment_list:function(){var i=this;$.ajax({url:"/api/commentList",type:"get",data:{article_id:this.article_id,page:this.comment_page},dataType:"json",success:function(e){if(200==e.code){var t=[];0!=e.body.list.length&&(t=e.body.list).forEach(function(e,t){e.comment_reply={flag:!1,content:""}}),i.comment_list=t,i.comment_count=e.body.count,0==e.body.count?i.comment_show=0:i.comment_show=1}else i.$message.warning(e.body)},error:function(){}})},pointPraise:function(t,i){var n=this;if(!getCookie("userInfo"))return goLogin(n,"给这条评论点赞需要登录，现在去登录？"),!1;1==t?(n.comment_list[i].isPraise=!0,n.comment_list[i].praise_count++):(n.comment_list[i].isPraise=!1,n.comment_list[i].praise_count--),$.ajax({url:"/api/pointPraise",type:"get",dataType:"json",data:{type:t,comment_id:n.comment_list[i].id},success:function(e){200!=e.code&&(n.$message.warning("操作失败，请稍后重试"),1==t?(n.comment_list[i].isPraise=!1,n.comment_list[i].praise_count--):(n.comment_list[i].isPraise=!0,n.comment_list[i].praise_count++))},error:function(){n.$message.error("当前网络不佳，请稍后重试"),1==t?(n.comment_list[i].isPraise=!1,n.comment_list[i].praise_count--):(n.comment_list[i].isPraise=!0,n.comment_list[i].praise_count++)}})},replyctrl:function(e,t){if(!getCookie("userInfo"))return goLogin(this,"回复这条评论需要登录，现在去登录？"),!1;var i=this.comment_list[t];if((i.comment_reply.flag=1)==e)var n=i.user_id;else n=i.reply_list[t].user_id;i.reply_person_id=n},reply_send:function(e){var t=this;if(!getCookie("userInfo"))return goLogin(t,"回复这条评论需要登录，现在去登录？"),!1;var i=t.comment_list[e];if(!i.comment_reply.content.length)return t.$message.warning("回复内容不能为空"),!1;$.ajax({url:"/api/publish/reply",type:"post",dataType:"json",data:{content:i.comment_reply.content,comment_id:i.id,reply_id:i.reply_person_id},success:function(e){200==e.code?(i.reply_list.push(e.body),i.comment_reply.content="",i.comment_reply.flag=!1,t.$message.success("回复成功")):t.$message.warning(e.body)},error:function(){t.$message.error("当前网络不佳，请稍后重试")}})},cancel_reply:function(e){this.comment_list[e].comment_reply.flag=!1},getrecommend:function(){var t=this;$.ajax({url:"/api/article/recommendList",type:"get",dataType:"json",data:{article_id:this.article_id,classify_id:this.classify_id},success:function(e){200==e.code&&(t.recommendList=e.body)}})}}});