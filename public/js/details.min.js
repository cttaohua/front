new Vue({delimiters:["${","}"],el:"#detailsPage",data:{article_id:"",classify_id:"",author_id:"",reviewFlag:!1,review_content:"",comment_list:[],comment_page:1,comment_count:0,comment_show:2,recommendList:[]},created:function(){},mounted:function(){var e=this;$(function(){e.init(),e.delayload(),e.qqFace()})},directives:{focus:{update:function(e,t){t.value&&e.focus()}}},filters:{date:dateYmdHis,rtQQ:function(e){return e=(e=(e=(e=e.replace(/\</g,"&lt;")).replace(/\>/g,"&gt;")).replace(/\n/g,"<br/>")).replace(/\[em_([0-9]*)\]/g,'<img src="/img/arclist/$1.gif" border="0" />')}},methods:{init:function(){var e=this;this.article_id=$("#article_id").val(),this.classify_id=$("#classify_id").val(),this.author_id=$("#author_id").val(),hljs.initHighlightingOnLoad(),$("img.lazy").lazyload({effect:"fadeIn"}),$("body").on("click",function(){$(".receipt_code").hide(500)}),$(".like-group").on("click",function(){getCookie("userId")?$(this).hasClass("unlike")?($(this).removeClass("unlike").addClass("islike"),e.likefun(1)):($(this).removeClass("islike").addClass("unlike"),e.likefun(0)):goLogin(e,"喜欢这篇文章需要登录，现在去登录？")})},delayload:function(){var e=this,t=1;$(window).scroll(function(){$("#comments")[0].offsetTop-$(window).scrollTop()<600&&1==t&&(t=0,e.getComment_list(),e.getrecommend())})},qqFace:function(){$(".main_emotion").length&&$(".main_emotion").qqFace({id:"facebox",assign:"main_comment_area",path:"../img/arclist/"})},rewardswitch:function(){$(".receipt_code").show(500)},likefun:function(e){var t=this;$.ajax({url:"/api/islike",type:"get",dataType:"json",data:{islike:e,article_id:this.article_id,author_id:this.author_id},success:function(e){200!=e.code&&t.$message.warning(e.body)},error:function(){t.$message.error("当前网络不佳，请稍后重试")}})},review_send:function(e){var t=this,i=$(e.currentTarget).parents(".review_container").find("textarea").val();if(!i.length)return this.$message.warning("回复内容不能为空"),!1;$.ajax({url:"/api/publish/comment",type:"post",dataType:"json",data:{article_id:this.article_id,content:i},success:function(e){200!=e.code?t.$message.warning(e.body):(t.review_content="",t.reviewFlag=!1,t.$message.success("评论成功"),t.comment_page=1,t.getComment_list())},error:function(){t.$message.error("当前网络不佳，请稍后重试")}})},pageChange:function(e){this.comment_page=e,this.getComment_list()},getComment_list:function(){var i=this;$.ajax({url:"/api/commentList",type:"get",data:{article_id:this.article_id,page:this.comment_page},dataType:"json",success:function(e){if(200==e.code){var t=[];0!=e.body.list.length&&((t=e.body.list).forEach(function(e,t){e.comment_reply={flag:!1,content:""}}),setTimeout(function(){$(".minor_emotion").each(function(e){$(".minor_emotion_"+e).qqFace({id:"facebox",assign:"minor_comment_area_"+e,path:"../img/arclist/"})})},1e3)),i.comment_list=t,i.comment_count=e.body.count,0==e.body.count?i.comment_show=0:i.comment_show=1}else i.$message.warning(e.body)},error:function(){}})},pointPraise:function(t,i){var n=this;if(!getCookie("userId"))return goLogin(n,"给这条评论点赞需要登录，现在去登录？"),!1;1==t?(n.comment_list[i].isPraise=!0,n.comment_list[i].praise_count++):(n.comment_list[i].isPraise=!1,n.comment_list[i].praise_count--),$.ajax({url:"/api/pointPraise",type:"get",dataType:"json",data:{type:t,comment_id:n.comment_list[i].id},success:function(e){200!=e.code&&(n.$message.warning("操作失败，请稍后重试"),1==t?(n.comment_list[i].isPraise=!1,n.comment_list[i].praise_count--):(n.comment_list[i].isPraise=!0,n.comment_list[i].praise_count++))},error:function(){n.$message.error("当前网络不佳，请稍后重试"),1==t?(n.comment_list[i].isPraise=!1,n.comment_list[i].praise_count--):(n.comment_list[i].isPraise=!0,n.comment_list[i].praise_count++)}})},replyctrl:function(e,t,i){if(!getCookie("userId"))return goLogin(this,"回复这条评论需要登录，现在去登录？"),!1;var n=this.comment_list[t];if(this.comment_list.forEach(function(e){e.comment_reply.flag=!1}),n.comment_reply.flag=!0,1==e)var s=n.user_id;else s=n.reply_list[i].user_id;n.reply_person_id=s},reply_send:function(e,t){var i=this;if(!getCookie("userId"))return goLogin(i,"回复这条评论需要登录，现在去登录？"),!1;var n=i.comment_list[e],s=$(t.currentTarget).parents(".review_container").find("textarea").val();if(!s.length)return i.$message.warning("回复内容不能为空"),!1;$.ajax({url:"/api/publish/reply",type:"post",dataType:"json",data:{content:s,comment_id:n.id,reply_id:n.reply_person_id},success:function(e){200==e.code?(n.reply_list.push(e.body),n.comment_reply.content="",n.comment_reply.flag=!1,i.$message.success("回复成功")):i.$message.warning(e.body)},error:function(){i.$message.error("当前网络不佳，请稍后重试")}})},cancel_reply:function(e){this.comment_list[e].comment_reply.flag=!1},getrecommend:function(){var t=this;$.ajax({url:"/api/article/recommendList",type:"get",dataType:"json",data:{article_id:this.article_id,classify_id:this.classify_id,first_id:$("#first_id").val()},success:function(e){200==e.code&&(t.recommendList=e.body)}})}}});