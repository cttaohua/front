new Vue({delimiters:["${","}"],el:"#chatPage",data:{socket:"",user_list:[],chat_list:[],current_obj:"",user_msg:""},created:function(){},mounted:function(){var t=this;$(function(){t.init()})},methods:{init:function(){this.socketFun(),this.getContacts(),this.user_msg=$("#user_msg").val()},socketFun:function(){var n=this;if(-1!=window.location.host.indexOf("localhost"))var t="127.0.0.1:3001";else t="taohuayuanskill.com";loadScript("https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js",function(){n.socket=io.connect(t,{path:"/socket",transports:["websocket"]}),n.socket.on("connect",function(){n.socket.emit("join",getCookie("userId"))}),n.socket.on("server_message",function(t){var e=JSON.parse(t);n.receiveMsg(e)})})},watchDiv:function(t){this.current_obj.curr_content=$(t.currentTarget).text()},sendMsg:function(){if(!this.current_obj.curr_content.length)return this.$message.warning("不能发送空消息"),!1;var t={from:getCookie("userId"),to:this.current_obj.relation_id,text:this.current_obj.curr_content,type:1};t=JSON.stringify(t),this.socket.emit("private_message",t),this.chat_list.push({head:this.user_msg.head,content:this.current_obj.curr_content,belong:1}),this.current_obj.prev_content="",this.current_obj.curr_content="",$("#chat-input").text("")},receiveMsg:function(t){t.from==this.current_obj.relation_id&&this.chat_list.push({head:this.current_obj.head,content:t.text,belong:2}),didiPlay()},getContacts:function(){var e=this;$.ajax({url:"/api/getContacts/list",type:"get",success:function(t){200==t.code&&(t.body.length&&(t.body.forEach(function(t){t.prev_content="",t.curr_content="",e.user_list.push(t)}),e.current_obj=e.user_list[0]))},error:function(){e.$message.error("当前网络不佳，请稍后重试")}})}}});